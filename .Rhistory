ggplotly(county_cases_map)
covid_time_series
?summarise
covid_time_series %>%
select(date, positive_cases) %>%
group_by(date) %>%
summarise(positive_cases = sum(positive_cases))
covid_time_series %>%
select(date, positive_cases) %>%
group_by(date) %>%
summarise(positive_cases = sum(positive_cases)) %>%
mutate(lag = lag(positive_cases))
covid_time_series %>%
select(date, positive_cases) %>%
group_by(date) %>%
summarise(positive_cases = sum(positive_cases)) %>%
mutate(lag = positive_cases - lag(positive_cases))
covid_time_series %>%
select(date, positive_cases) %>%
group_by(date) %>%
summarise(positive_cases = sum(positive_cases)) %>%
mutate(new_cases = positive_cases - lag(positive_cases)) %>%
ggplot(aes(x = date, y = positive_cases)) +
geom_line() +
geom_point() +
geom_bar(aes(y = new_cases))
ovid_time_series %>%
select(date, positive_cases) %>%
group_by(date) %>%
summarise(positive_cases = sum(positive_cases)) %>%
mutate(new_cases = positive_cases - lag(positive_cases)) %>%
ggplot(aes(x = date, y = positive_cases)) +
geom_line() +
geom_point() +
geom_bar(aes(y = new_cases, stat = "identity"))
covid_time_series %>%
select(date, positive_cases) %>%
group_by(date) %>%
summarise(positive_cases = sum(positive_cases)) %>%
mutate(new_cases = positive_cases - lag(positive_cases)) %>%
ggplot(aes(x = date, y = positive_cases)) +
geom_line() +
geom_point() +
geom_bar(aes(y = new_cases, stat = "identity"))
covid_time_series %>%
select(date, positive_cases) %>%
group_by(date) %>%
summarise(positive_cases = sum(positive_cases)) %>%
mutate(new_cases = positive_cases - lag(positive_cases)) %>%
ggplot(aes(x = date, y = positive_cases)) +
geom_line() +
geom_point() +
geom_bar(aes(y = new_cases), stat = "identity")
covid_time_series %>%
select(date, positive_cases) %>%
group_by(date) %>%
summarise(positive_cases = sum(positive_cases)) %>%
mutate(new_cases = positive_cases - lag(positive_cases)) %>%
ggplot(aes(x = date, y = positive_cases)) +
geom_line() +
geom_point() +
geom_bar(aes(y = new_cases), stat = "identity")
labs(x = "Date",
y = "Positive Cases",
title = "COVID-19 in New York State")
covid_time_series %>%
select(date, positive_cases) %>%
group_by(date) %>%
summarise(positive_cases = sum(positive_cases)) %>%
mutate(new_cases = positive_cases - lag(positive_cases)) %>%
ggplot(aes(x = date, y = positive_cases)) +
geom_line() +
geom_point() +
geom_bar(aes(y = new_cases), stat = "identity") +
labs(x = "Date",
y = "Positive Cases",
title = "COVID-19 in New York State")
covid_ny_map <- covid_time_series %>%
select(date, positive_cases) %>%
group_by(date) %>%
summarise(positive_cases = sum(positive_cases)) %>%
mutate(new_cases = positive_cases - lag(positive_cases)) %>%
ggplot(aes(x = date, y = positive_cases)) +
geom_line() +
geom_point() +
geom_bar(aes(y = new_cases), stat = "identity") +
labs(x = "Date",
y = "Positive Cases",
title = "COVID-19 in New York State")
ggplotly(covid_ny_map)
covid_ny_map <- covid_time_series %>%
select(date, positive_cases) %>%
group_by(date) %>%
summarise(positive_cases = sum(positive_cases)) %>%
mutate(new_cases = positive_cases - lag(positive_cases)) %>%
ggplot(aes(x = date, y = positive_cases)) +
geom_line() +
geom_point() +
geom_bar(aes(y = new_cases), stat = "identity") +
labs(x = "Date",
y = "Positive Cases",
title = "COVID-19 in New York State") +
legend_right()
ggplotly(covid_ny_map)
covid_ny_map <- covid_time_series %>%
select(date, positive_cases) %>%
group_by(date) %>%
summarise(positive_cases = sum(positive_cases)) %>%
mutate(new_cases = positive_cases - lag(positive_cases)) %>%
ggplot(aes(x = date, y = positive_cases)) +
geom_line() +
geom_point() +
geom_bar(aes(y = new_cases), stat = "identity") +
labs(x = "Date",
y = "Positive Cases",
title = "COVID-19 in New York State") +
theme(legend.position = "right")
ggplotly(covid_ny_map)
install.packages('rsconnect')
Warning messages:
1: invalid uid value replaced by that for user 'nobody'
2: invalid gid value replaced by that for user 'nobody'
rsconnect::setAccountInfo(name='smarquez',
token='6538057B2CC048FA3FFD17C189659A09',
secret='EW8KSdyhD8kYn6Bv/hBBd5n15ghORT42tvo5esRE')
library(tidyverse)
library(stringr)
library(rvest)
url <- read_html("https://health.ny.gov/diseases/communicable/coronavirus/")
covid_count_table <- html_nodes(url, "table") %>%
.[[1]] %>%
html_table() %>%
rename("County" = "") %>%
filter(!grepl("Outside|Statewide", County)) %>%
mutate(County = gsub(" County", "", County)) %>%
mutate(Date = Sys.Date())
html_nodes(url, "table") %>%
.[[1]] %>%
html_table() %>%
rename("County" = "") %>%
filter(!grepl("Outside|Statewide", County)) %>%
mutate(County = gsub(" County", "", County)) %>%
mutate(Date = Sys.Date())
path_countdata <- paste0("data/covid_count_daily/", Sys.Date())
write_csv(covid_count_table, path = path_countdata)
library(tidyverse)
library(data.table)
library(sf)
library(janitor)
latest_file <- fread(paste0("data/covid_count_daily/", Sys.Date()))
nys_map <- st_read("data/NYS_Civil_Boundaries_SHP/Counties_Shoreline.shp") %>%
mutate(NAME_NYC = ifelse(NYC == "Y", "New York City", as.character(NAME))) %>%
left_join(latest_file, by = c("NAME_NYC" = "County")) %>%
clean_names()
file.remove("data/covid_count_map/covid_count.shp")
st_write(nys_map, "data/covid_count_map/covid_count.shp")
## Function to rbind all files
list_files <- paste0("data/covid_count_daily/", list.files(path = "data/covid_count_daily/"))
covid_bind_fx <- function(list_files){
tables <- list()
tables <- lapply(list_files, fread, header = TRUE)
covid_series <- do.call(rbind, tables)
return(covid_series)
}
covid_series <- covid_bind_fx(list_files = list_files)
file.remove("data/covid_time_series/covid_time_series.csv")
write_csv(covid_series, "data/covid_time_series/covid_time_series.csv")
covid_time_series
covid_time_series <- fread("data/covid_time_series/covid_time_series.csv") %>%
clean_names() %>%
mutate(date = ymd(date))
library(flexdashboard)
library(mapview)
library(leaflet)
library(dichromat)
library(ggthemr)
library(plotly)
library(lubridate)
library(data.table)
library(sp)
library(sf)
library(tidyverse)
library(janitor)
# Load datasets
covid_map <- st_read("data/covid_count_map/covid_count.shp") %>%
rename("positive_cases" = "pstv_cs")
covid_time_series <- fread("data/covid_time_series/covid_time_series.csv") %>%
clean_names() %>%
mutate(date = ymd(date))
levels <- covid_time_series %>%
filter(date == max(date)) %>%
arrange(desc(positive_cases)) %>%
select(county) %>%
pull(county)
covid_time_series$county <- factor(covid_time_series$county, levels = levels)
covid_time_series
covid_time_series %>%
filter(date == max(date)) %>%
arrange(desc(positive_cases)) %>%
select(county) %>%
pull(county)
fread("data/covid_time_series/covid_time_series.csv") %>%
clean_names() %>%
mutate(date = ymd(date))
ovid_time_series %>%
filter(date = max(date))
covid_time_series %>%
filter(date = max(date))
covid_time_series %>%
filter(date == max(date))
covid_time_series %>%
filter(date == max(date)) %>%
arrange(desc(positive_cases))
covid_time_series %>%
filter(date == max(date)) %>%
arrange(desc(positive_cases)) %>%
top_n(n = 8)
covid_time_series %>%
filter(date == max(date)) %>%
arrange(desc(positive_cases)) %>%
top_n(n = 8)
covid_time_series %>%
filter(date == max(date)) %>%
arrange(desc(positive_cases)) %>%
filter(top_n(n = 8))
covid_time_series %>%
filter(date == max(date)) %>%
arrange(desc(positive_cases)) %>%
top_n(n = 8, positive_cases)
covid_time_series %>%
filter(date == max(date)) %>%
arrange(desc(positive_cases)) %>%
group_by(positive_cases) %>%
top_n(n = 8, positive_cases)
covid_time_series %>%
filter(date == max(date)) %>%
arrange(desc(positive_cases)) %>%
head(8)
covid_time_series %>%
filter(date == max(date)) %>%
arrange(desc(positive_cases)) %>%
head(8) %>%
select(county) %>%
pull(county)
covid_time_series %>%
mutate(county = ifelse(county %in% top_8), county, "Other")
top_8 <- covid_time_series %>%
filter(date == max(date)) %>%
arrange(desc(positive_cases)) %>%
head(8) %>%
select(county) %>%
pull(county)
covid_time_series %>%
mutate(county = ifelse(county %in% top_8), county, "Other")
covid_time_series %>%
mutate(county = ifelse(county %in% top_8, county, "Other"))
covid_time_series %>%
mutate(county = ifelse(county %in% top_8, character(county), "Other"))
covid_time_series %>%
mutate(county = ifelse(county %in% top_8, as.character(county), "Other"))
covid_time_series <- covid_time_series %>%
mutate(county = ifelse(county %in% top_8, as.character(county), "Other")) %>%
group_by(county, date) %>%
summarise(positive_cases = sum(positive_cases))
View(covid_time_series)
covid_time_series %>%
filter(date == max(date)) %>%
arrange(desc(positive_cases)) %>%
select(county) %>%
pull(county)
rm(top_8)
# Load datasets
covid_map <- st_read("data/covid_count_map/covid_count.shp") %>%
rename("positive_cases" = "pstv_cs")
covid_time_series <- fread("data/covid_time_series/covid_time_series.csv") %>%
clean_names() %>%
mutate(date = ymd(date))
top_7 <- covid_time_series %>%
filter(date == max(date)) %>%
arrange(desc(positive_cases)) %>%
head(7) %>%
select(county) %>%
pull(county)
covid_time_series <- covid_time_series %>%
mutate(county = ifelse(county %in% top_7, as.character(county), "Other")) %>%
group_by(county, date) %>%
summarise(positive_cases = sum(positive_cases))
levels <- covid_time_series %>%
filter(date == max(date)) %>%
arrange(desc(positive_cases)) %>%
select(county) %>%
pull(county)
levels
covid_time_series$county <- factor(covid_time_series$county, levels = levels)
ggthemr("dust")
county_cases_map <- covid_time_series %>%
ggplot(aes(x = date, y = positive_cases, group = county, colour = county)) +
geom_line() +
geom_point() +
labs(x = "Date",
y = "Positive Cases",
title = "Cummulative COVID-19 in New York State counties")
covid_time_series %>%
ggplot(aes(x = date, y = positive_cases, group = county, colour = county))
covid_time_series %>%
ggplot(aes(x = date, y = positive_cases, group = county, colour = county)) +
geom_line()
rm(county_cases_map)
covid_time_series %>%
ggplot(aes(x = date, y = positive_cases, group = county, colour = county)) +
geom_line() +
geom_point() +
labs(x = "Date",
y = "Positive Cases",
title = "Cummulative COVID-19 in New York State counties")
ggthemr("dust")
county_cases_counties <- covid_time_series %>%
ggplot(aes(x = date, y = positive_cases, group = county, colour = county)) +
geom_line() +
geom_point() +
labs(x = "Date",
y = "Positive Cases",
title = "Cummulative COVID-19 in New York State counties")
ggplotly(county_cases_counties)
# Load datasets
covid_map <- st_read("data/covid_count_map/covid_count.shp") %>%
rename("positive_cases" = "pstv_cs")
covid_time_series <- fread("data/covid_time_series/covid_time_series.csv") %>%
clean_names() %>%
mutate(date = ymd(date))
top_7 <- covid_time_series %>%
filter(date == max(date)) %>%
arrange(desc(positive_cases)) %>%
head(7) %>%
select(county) %>%
pull(county)
covid_time_series <- covid_time_series %>%
mutate(county = ifelse(county %in% top_7, as.character(county), "Other")) %>%
group_by(county, date) %>%
summarise(positive_cases = sum(positive_cases)) %>%
ungroup()
levels <- covid_time_series %>%
filter(date == max(date)) %>%
arrange(desc(positive_cases)) %>%
select(county) %>%
pull(county)
covid_time_series$county <- factor(covid_time_series$county, levels = levels)
d
county_cases_counties <- covid_time_series %>%
ggplot(aes(x = date, y = positive_cases, group = county, colour = county)) +
geom_line() +
geom_point() +
labs(x = "Date",
y = "Positive Cases",
title = "Cummulative COVID-19 in New York State counties")
ggplotly(county_cases_counties)
rm(covid_ny_map)
covid_ny <- covid_time_series %>%
select(date, positive_cases) %>%
group_by(date) %>%
summarise(positive_cases = sum(positive_cases)) %>%
mutate(new_cases = positive_cases - lag(positive_cases)) %>%
ggplot(aes(x = date, y = positive_cases)) +
geom_line() +
geom_point() +
geom_bar(aes(y = new_cases), stat = "identity") +
labs(x = "Date",
y = "Positive Cases",
title = "Cummulative COVID-19 in New York State") +
theme(legend.position = "right")
ggplotly(covid_ny)
pal <- colorRampPalette(c("#fae6c0", "#7A6752"))
m <- mapview(covid_map,
zcol = "positive_cases",
col.regions = pal,
alpha = 0.8,
alpha.regions = 0.9,
label = cc(ounty, positive_cases))
m@map %>% setView(lng = -74, lat = 42, zoom = 6.5)
m@map %>% setView(lng = -74, lat = 42, zoom = 6.5) %>%
leaflet::addMarkers(label = covid_map$name)
m@map %>% setView(lng = -74, lat = 42, zoom = 6.5) %>%
leaflet::addMarkers(label = covid_map$name)
m <- mapview(covid_map,
zcol = "positive_cases",
col.regions = pal,
alpha = 0.8,
alpha.regions = 0.9)
m@map %>% setView(lng = -74, lat = 42, zoom = 6.5) %>%
leaflet::addMarkers(label = covid_map$name)
m <- mapview(covid_map,
zcol = "positive_cases",
col.regions = pal,
alpha = 0.8,
alpha.regions = 0.9)
m@map %>% setView(lng = -74, lat = 42, zoom = 6.5)
nys_map
names(nys_map)
nys_map$date
st_read("data/NYS_Civil_Boundaries_SHP/Counties_Shoreline.shp") %>%
mutate(NAME_NYC = ifelse(NYC == "Y", "New York City", as.character(NAME))) %>%
left_join(latest_file, by = c("NAME_NYC" = "County")) %>%
clean_names() %>%
select(name, positive_cases, date, name_nyc, geometry)
nys_map <- st_read("data/NYS_Civil_Boundaries_SHP/Counties_Shoreline.shp") %>%
mutate(NAME_NYC = ifelse(NYC == "Y", "New York City", as.character(NAME))) %>%
left_join(latest_file, by = c("NAME_NYC" = "County")) %>%
clean_names() %>%
select(name, positive_cases, date, name_nyc, geometry)
names(nys_map)
View(nys_map)
library(tidyverse)
library(data.table)
library(sf)
library(janitor)
latest_file <- fread(paste0("data/covid_count_daily/", Sys.Date()))
nys_map <- st_read("data/NYS_Civil_Boundaries_SHP/Counties_Shoreline.shp") %>%
mutate(NAME_NYC = ifelse(NYC == "Y", "New York City", as.character(NAME))) %>%
left_join(latest_file, by = c("NAME_NYC" = "County")) %>%
clean_names() %>%
select(name, positive_cases, date, name_nyc, geometry)
file.remove("data/covid_count_map/covid_count.shp")
st_write(nys_map, "data/covid_count_map/covid_count.shp")
st_read("data/covid_count_map/covid_count.shp")
names(st_read("data/covid_count_map/covid_count.shp"))
covid_map <- st_read("data/covid_count_map/covid_count.shp") %>%
rename("positive_cases" = "pstv_cs",
"name_nyc" = "nam_nyc")
pal <- colorRampPalette(c("#fae6c0", "#7A6752"))
m <- mapview(covid_map,
zcol = "positive_cases",
col.regions = pal,
alpha = 0.8,
alpha.regions = 0.9)
m@map %>% setView(lng = -74, lat = 42, zoom = 6.5)
covid_time_series %>%
ggplot(aes(x = date, y = positive_cases, group = county, colour = county)) +
geom_line() +
geom_point() +
labs(x = "Date",
y = "Positive Cases",
title = "Cummulative COVID-19 in New York State counties"
caption = "Source: https://health.ny.gov/diseases/communicable/coronavirus/")
covid_time_series %>%
ggplot(aes(x = date, y = positive_cases, group = county, colour = county)) +
geom_line() +
geom_point() +
labs(x = "Date",
y = "Positive Cases",
title = "Cummulative COVID-19 in New York State counties",
caption = "Source: https://health.ny.gov/diseases/communicable/coronavirus/")
covid_time_series %>%
ggplot(aes(x = date, y = positive_cases, group = county, colour = county)) +
geom_line() +
geom_point() +
labs(x = "Date",
y = "Positive Cases",
title = "Cummulative COVID-19 in New York State counties",
caption = "Source")
covid_time_series %>%
ggplot(aes(x = date, y = positive_cases, group = county, colour = county)) +
geom_line() +
geom_point() +
labs(x = "Date",
y = "Positive Cases",
title = "Cummulative COVID-19 in New York State counties",
caption = "Source: [New York State Department of Health](https://health.ny.gov/diseases/communicable/coronavirus/)")
Sys.Date()
url <- read_html("https://health.ny.gov/diseases/communicable/coronavirus/")
library(tidyverse)
library(stringr)
library(rvest)
url <- read_html("https://health.ny.gov/diseases/communicable/coronavirus/")
html_nodes(url, "table") %>%
.[[1]] %>%
html_table() %>%
rename("County" = "") %>%
filter(!grepl("Outside|Statewide", County)) %>%
mutate(County = gsub(" County", "", County)) %>%
mutate(Date = Sys.Date())
covid_count_table <- html_nodes(url, "table") %>%
.[[1]] %>%
html_table() %>%
rename("County" = "") %>%
filter(!grepl("Outside|Statewide", County)) %>%
mutate(County = gsub(" County", "", County)) %>%
mutate(Date = Sys.Date())
path_countdata <- paste0("data/covid_count_daily/", Sys.Date())
write_csv(covid_count_table, path = path_countdata)
library(tidyverse)
library(data.table)
library(sf)
library(janitor)
latest_file <- fread(paste0("data/covid_count_daily/", Sys.Date()))
nys_map <- st_read("data/NYS_Civil_Boundaries_SHP/Counties_Shoreline.shp") %>%
mutate(NAME_NYC = ifelse(NYC == "Y", "New York City", as.character(NAME))) %>%
left_join(latest_file, by = c("NAME_NYC" = "County")) %>%
clean_names() %>%
select(name, positive_cases, date, name_nyc, geometry)
file.remove("data/covid_count_map/covid_count.shp")
st_write(nys_map, "data/covid_count_map/covid_count.shp")
## Function to rbind all files
list_files <- paste0("data/covid_count_daily/", list.files(path = "data/covid_count_daily/"))
covid_bind_fx <- function(list_files){
tables <- list()
tables <- lapply(list_files, fread, header = TRUE)
covid_series <- do.call(rbind, tables)
return(covid_series)
}
covid_series <- covid_bind_fx(list_files = list_files)
file.remove("data/covid_time_series/covid_time_series.csv")
write_csv(covid_series, "data/covid_time_series/covid_time_series.csv")
